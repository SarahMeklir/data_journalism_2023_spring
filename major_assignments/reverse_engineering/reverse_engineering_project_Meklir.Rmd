---
title: "Reverse Engineering Project"
author: "Student names here"
date: "Date here"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, we are reverse engineering the story, [STORY NAME](STORY URL)

## Load libraries 
## LOAD THE URL WHICH IS THIS: https://www.propublica.org/article/in-north-carolina-black-voters-mail-in-ballots-much-more-likely-to-be-rejected-than-those-from-any-other-race 

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}
library(tidyverse)
library(janitor)
library(lubridate)
```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}
# Load required data

# Path to data should be loaded from folder "data" i.e. read_csv("data/name_of_data.csv")
absentee_data <- read_csv("~/Documents/data_journalism_2023_spring/major_assignments/reverse_engineering/data/absentee_20181106.csv", guess_max=2111797) 

absentee_data
# Clean required data and prepare for analysis if needed.

# Alright! So! Our plan is to filter by mail-in ballots that weren't accepted (excluding those marked "not voted"), get the total number of mail-in ballots that weren't accepted for each race, and sort them from in descending order to see whether their headline is accurate. For reference, their headline was "In North Carolina, Black Voters’ Mail-In Ballots Much More Likely to Be Rejected Than Those From Any Other Race".
```

## Sentences to Engineer
In this notebook, we are reverse engineering five sentences from the story.

### Sentence 1

* **Sentence text**: "In North Carolina, Black Voters’ Mail-In Ballots Much More Likely to Be Rejected Than Those From Any Other Race"
* **Analysis summary**: We confirmed the finding. We first filtered by mail to find the total ballots for each race. Then we filtered to keep the mail ballots and statuses that seemed like they constituted a "rejection", and found race totals for that. Finally, we went through individually by race and found each one's mail ballot rejection rate by dividing the rejected totals by overall totals and found the highest rate was a 12.4% rejection rate for Black mail-in ballots while the second-highest is 6.8% rejected among Indian American or Alaska Native mail-in ballots.

```{r}
# Put code to reverse engineer sentence here
ballot_total_by_race <- absentee_data %>% 
  filter((ballot_req_type == 'MAIL'), (ballot_rtn_dt != "NA")) %>% 
  group_by(race) %>% 
  summarize(ballot_total = n()) %>% 
  arrange(desc(ballot_total))

rejected_total_by_race <- absentee_data %>%  
  filter((ballot_req_type == 'MAIL'), (ballot_rtn_dt != "NA")) %>% 
  filter((ballot_rtn_status == "WRONG VOTER") | (ballot_rtn_status == "WITNESS INFO INCOMPLETE") | (ballot_rtn_status == "VOTER SIGNATURE MISSING") | (ballot_rtn_status == "SPOILED") | (ballot_rtn_status == "NOT PROPERLY NOTARIZED") | (ballot_rtn_status == "SIGNATURE DIFFERENT") | (ballot_rtn_status == "RETURNED UNDELIVERABLE")) %>% 
  group_by(race) %>% 
  summarize(rejected_totals = n()) %>% 
  arrange(desc(rejected_totals))

# Display results of code below this codeblock
ballot_total_by_race
rejected_total_by_race

# Individually finding the rate for each race
race_rejection_rates <- absentee_data %>% 
  mutate(white_rate = 3140/78161) %>% 
  mutate(black_rate = 1847/14915) %>% 
  mutate(undesignated_rate = 225/5011) %>% 
  mutate(asian_rate = 144/2516) %>% 
  mutate(other_rate = 130/2161) %>% 
  mutate(indian_american_or_alaska_native_rate = 39/571) %>% 
  mutate(two_or_more_rate = 42/756) %>% 
  summarize(white_rate, black_rate, undesignated_rate, asian_rate, other_rate, indian_american_or_alaska_native_rate, two_or_more_rate)

race_rejection_rates
# We added the mail filter you gave us in reverse_engineering_project_milestone_03 to sort through the correct types of ballots
```

### Sentence 2

* **Sentence text**: "In North Carolina, a swing state, Black voters are the largest racial group among Democratic voters, making up 46% of party members."
* **Analysis summary**: We almost confirmed the finding. We got 44.3% versus the almost 46% in the story. To do this, we filtered by democratic voter party code (though I'm not sure what that means), then counted the ballots for each race and divided that by the total rows in the data set.

```{r}
# Put code to reverse engineer sentence here
question_two <- absentee_data %>% 
  filter(voter_party_code == "DEM") %>% 
  group_by(race) %>% 
  summarise(race_totals = n()) %>% 
  mutate(race_pct = race_totals/899195)
# Display results of code below this codeblock
question_two
```

### Sentence 3

* **Sentence text**: "The analysis by ProPublica and WRAL News shows 40% of rejected ballots were submitted by voters who identify as Black or African American, Indian American or Alaska Native, Asian, two or more races, or “other.”"
* **Analysis summary**: Our result was 43.54%, which comes very close to confirming the finding. We took a similar approach as with our previous two questions and first found the total rejected ballots then found the percentages. Once we had our percentage data, we added up Black or African American, Indian American or Alaska Native, Asian, two or more races, or "other", rounding to the nearest hundredth. 

```{r}
# Put code to reverse engineer sentence here
rejected_total <- absentee_data %>% 
  filter((ballot_rtn_dt != "NA"), (ballot_req_type == 'MAIL')) %>% 
  filter((ballot_rtn_status == "WRONG VOTER") | (ballot_rtn_status == "WITNESS INFO INCOMPLETE") | (ballot_rtn_status == "VOTER SIGNATURE MISSING") | (ballot_rtn_status == "SPOILED") | (ballot_rtn_status == "NOT PROPERLY NOTARIZED") | (ballot_rtn_status == "RETURNED UNDELIVERABLE")) %>% 
  summarize(total_rejected = n())
  
question_three <- absentee_data %>% 
  filter((ballot_rtn_dt != "NA"), (ballot_req_type == 'MAIL')) %>% 
  filter((ballot_rtn_status == "WRONG VOTER") | (ballot_rtn_status == "WITNESS INFO INCOMPLETE") | (ballot_rtn_status == "VOTER SIGNATURE MISSING") | (ballot_rtn_status == "SPOILED") | (ballot_rtn_status == "NOT PROPERLY NOTARIZED") | (ballot_rtn_status == "RETURNED UNDELIVERABLE")) %>%
  group_by(race) %>% 
  summarize(race_totals = n()) %>% 
  mutate(race_pct = (race_totals/5600)*100) %>% 
  arrange(desc(race_pct))
# Display results of code below this codeblock
rejected_total
question_three
```

### Sentence 4

* **Sentence text**: "As of Sept. 23, the rejection rate for mail-in ballots submitted by Black voters was about 3%"
* **Analysis summary**: We were able to come close to the finding, but our result was 6.66%. The totals we got seemed too small, but we did everything we could think of to fix it. As before, we filtered by mail Black ballots returned before 9/23/18. We also had to change the datatype for date so it could filter. That gave us the total rejected ballots. Afterward we filtered just Black mail ballots returned before that date and got the ballot total. Finally we divided the rejected total by the ballot total and got our rate.

```{r}
# Put code to reverse engineer sentence here
question_four <- absentee_data %>% 
  mutate(ballot_rtn_dt = mdy(ballot_rtn_dt)) %>% 
  filter((ballot_req_type == 'MAIL'), (race == "BLACK or AFRICAN AMERICAN"), (ballot_rtn_dt <= "2018-09-23")) %>% 
  filter((ballot_rtn_status == "WRONG VOTER") | (ballot_rtn_status == "WITNESS INFO INCOMPLETE") | (ballot_rtn_status == "VOTER SIGNATURE MISSING") | (ballot_rtn_status == "SPOILED") | (ballot_rtn_status == "NOT PROPERLY NOTARIZED") | (ballot_rtn_status == "RETURNED UNDELIVERABLE")) %>% 
  summarize(rejected_black_mail_ballots = n())

total_black_ballots <- absentee_data %>% 
  mutate(ballot_rtn_dt = mdy(ballot_rtn_dt)) %>% 
  filter((ballot_rtn_dt <= "2018-09-23"), (ballot_req_type == 'MAIL'), (race == "BLACK or AFRICAN AMERICAN")) %>% 
  summarize(total_black_mail_ballots = n())

########## add returned ballots. duh.

# Display results of code below this codeblock
question_four
total_black_ballots

total_black_ballots %>% 
  summarize(rejected_black_mail_ballot_rate = (1/total_black_mail_ballots)*100)

```

### Sentence 5

* **Sentence text**: "Guilford County, the third-most populous county in North Carolina, rejected the largest number of mail-in ballots by Black voters statewide: 177"
* **Analysis summary**: We got SO close to the finding!! Our result was 162 rejected Black mail-in ballots in Guilford County. However, the county did reject the largest number of mail-in ballots by Black voters. We filtered by mail Black ballots returned and rejected to get the total rejected ballots. Then we grouped by county and found the total counts for each and sorted in descending order.

```{r}
# Put code to reverse engineer sentence here
question_five <- absentee_data %>% 
  filter((ballot_rtn_status == "WRONG VOTER") | (ballot_rtn_status == "WITNESS INFO INCOMPLETE") | (ballot_rtn_status == "VOTER SIGNATURE MISSING") | (ballot_rtn_status == "SPOILED") | (ballot_rtn_status == "NOT PROPERLY NOTARIZED") | (ballot_rtn_status == "RETURNED UNDELIVERABLE")) %>% 
  filter((ballot_req_type == 'MAIL'), (race == "BLACK or AFRICAN AMERICAN"), (ballot_rtn_dt != "NA")) %>% 
  
  group_by(county_desc) %>% 
  summarize(county_rejected_total = n()) %>% 
  arrange(desc(county_rejected_total))
  question_five
  
# Display results of code below this codeblock

```

-30-